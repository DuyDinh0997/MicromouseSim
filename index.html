<html>

<head>
	<title>Micromouse Simulator</title>

	<link rel="stylesheet" href="main.css" type="text/css">
</head>


<body>


<h2>Micromouse Simulator</h2>


<div id="maze_div">
<form>
<span class="heading">Maze</span>

<div class="select">
<label for="maze_sel">Select Maze</label>
<select name="maze_sel" id="maze_sel">
  <option value="00japan">00japan</option>
  <option value="1stworld">1stworld</option>
  <option value="80japx">80japx</option>
  <option value="81japx">81japx</option>

  <option value="82japx">82japx</option>
  <option value="82us">82us</option>
  <option value="83jap">82japx</option>
  <option value="83japx">83japx</option>
  <option value="83us">83us</option>
  <option value="84japx">84japx</option>
  <option value="85japx">85japx</option>
  <option value="85usa">85usa</option>
  <option value="86">86</option>
  <option value="86chi">86chi</option>
  <option value="86jap">86jap</option>
  <option value="86japx">86japx</option>
  <option value="87iee">87iee</option>
  <option value="87jap">87jap</option>
  <option value="87japx">87japx</option>
  <option value="87sin">87sin</option>
  <option value="87us1">87us1</option>
  <option value="88iee">88iee</option>
  <option value="88jap">88jap</option>
  <option value="88japx">88japx</option>
  <option value="88lon">88lon</option>
  <option value="88mtl">88mtl</option>
  <option value="88sin">88sin</option>
  <option value="88us">88us</option>
  <option value="89ape">89ape</option>
  <option value="89iee">89iee</option>
  <option value="89japa1">89japa1</option>
  <option value="89japa2">89japa2</option>
  <option value="89japx">89japx</option>
  <option value="89lon">89lon</option>
  <option value="89lonq">89lonq</option>
</select>
</div>

<canvas id="maze" width="512" height="512"> </canvas>

<div id="maze_controls_div">
<button id = "home" type="button">Home</button>
<button id = "start_stop" type="button">Start</button>
<button id = "step" type="button">Step</button>
</div>
</form>
</div>

<div id="driver_div">
<form>
<span class="heading">Mouse Algorithm</span>

<div class="select">
<label for="driver_sel">Select Template</label>
<select name="driver_sel" id="driver_sel">
  <option value="fwd_back">Forward and Back</option>
  <option value="right_wall">Right Wall Follow</option>
</select>
</div>

<textarea id="driver_code" rows=30> 
driver = {};

driver.next = function() {
   var x = mouse.x();
   var y = mouse.y();

   if (mouse.isGoal()) {
      alert("Goal Reached!");
      mouse.stop();
      return;
   }

   if (mouse.isOpenRight()) {
      mouse.right();
      mouse.fwd();
   } else if (mouse.isOpenFwd()) {
      mouse.fwd();
   } else {
      mouse.left();
      mouse.fwd();
   }
}

</textarea>

<div id="code_controls_div">
<button id="download" type="button" disabled="disabled">Download to mouse</button>
</div>

</form>

</div>



</body>

<script type="text/javascript" src="jquery-1.5.2.min.js"></script>
<script type="text/javascript" src="maze.js"></script>
<script type="text/javascript" src="driver.js"></script>

<script type="text/javascript">
jQuery(function() {

	$('#driver_code').change(
		function(event) {
			$("#download").attr("disabled",false);
		}
	);

	$('#download').click(
		function(event) {
			var code = $("#driver_code").val();
			jQuery.globalEval(code);
			mouse.loadDriver(driver);
			$("#download").attr("disabled",true);
		}
	);

	$('#start_stop').click(
		function(event) {
			if ($('#start_stop').html() === 'Start') {
				mouse.start();
				$('#start_stop').html('Stop');

			} else {
				mouse.stop();
				$('#start_stop').html('Start');
			}
		}
	);

	$('#maze_sel').change(
		function(event) {
			var maze_json = "mazes_json/" + 
				$('#maze_sel').val() + ".json";
			mouse.loadMaze(maze_json);
		}
	);

	$('#step').click(mouse.step);
	$('#home').click(mouse.home);

	var maze_file = "mazes_json/00japan.json";

	mouse.newMaze($('#start_stop'),maze_file);
	mouse.loadDriver(driver);

	var maze_height = $("canvas#maze").height() + 8;
	// console.log("maze_height: " + maze_height);
	$("#driver_div").height(maze_height);

});
</script>



</html>
